<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ä¼ æ„Ÿå™¨è°ƒè¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f0f0f0; 
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold; 
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        button { 
            padding: 15px 20px; 
            font-size: 16px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 0; 
            width: 100%; 
        }
        button:hover { background: #0056b3; }
        .data { 
            font-family: monospace; 
            background: #e9ecef; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ä¼ æ„Ÿå™¨è°ƒè¯•å·¥å…·</h1>
    
    <div id="browser-info" class="status warning">æ£€æµ‹æµè§ˆå™¨...</div>
    <div id="api-support" class="status warning">æ£€æµ‹APIæ”¯æŒ...</div>
    <div id="permission-status" class="status warning">æƒé™çŠ¶æ€: æœªçŸ¥</div>
    
    <button onclick="testBasicSupport()">1ï¸âƒ£ æµ‹è¯•åŸºç¡€æ”¯æŒ</button>
    <button onclick="requestPermissionManual()">2ï¸âƒ£ æ‰‹åŠ¨è¯·æ±‚æƒé™</button>
    <button onclick="startListening()">3ï¸âƒ£ å¼€å§‹ç›‘å¬ä¼ æ„Ÿå™¨</button>
    <button onclick="testConsoleOutput()">4ï¸âƒ£ æ§åˆ¶å°è¾“å‡ºæµ‹è¯•</button>
    
    <div class="data">
        <strong>ä¼ æ„Ÿå™¨æ•°æ®:</strong><br>
        <div id="sensor-data">ç­‰å¾…æ•°æ®...</div>
    </div>
    
    <div class="data">
        <strong>è°ƒè¯•æ—¥å¿—:</strong><br>
        <div id="debug-log">åˆå§‹åŒ–ä¸­...</div>
    </div>

    <script>
        let isListening = false;
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('debug-log');
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        function updateStatus(elementId, message, type = 'warning') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        // åˆå§‹åŒ–æ£€æµ‹
        window.addEventListener('load', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ£€æµ‹');
            
            // æµè§ˆå™¨æ£€æµ‹
            const userAgent = navigator.userAgent;
            let browser = 'Unknown';
            if (userAgent.includes('Chrome')) browser = 'Chrome';
            else if (userAgent.includes('Firefox')) browser = 'Firefox';
            else if (userAgent.includes('Safari')) browser = 'Safari';
            
            updateStatus('browser-info', `æµè§ˆå™¨: ${browser} | HTTPS: ${location.protocol === 'https:'}`, 'success');
            log(`æµè§ˆå™¨: ${browser}, User Agent: ${userAgent}`);
            
            testBasicSupport();
        });
        
        function testBasicSupport() {
            log('=== å¼€å§‹åŸºç¡€æ”¯æŒæµ‹è¯• ===');
            
            const orientationSupport = !!window.DeviceOrientationEvent;
            const motionSupport = !!window.DeviceMotionEvent;
            const hasRequestPermission = typeof DeviceOrientationEvent.requestPermission === 'function';
            
            log(`DeviceOrientationEventæ”¯æŒ: ${orientationSupport}`);
            log(`DeviceMotionEventæ”¯æŒ: ${motionSupport}`);
            log(`requestPermissionæ–¹æ³•: ${hasRequestPermission}`);
            
            if (orientationSupport || motionSupport) {
                updateStatus('api-support', 'âœ… ä¼ æ„Ÿå™¨APIæ”¯æŒ', 'success');
                log('ä¼ æ„Ÿå™¨APIåŸºç¡€æ”¯æŒæ­£å¸¸');
            } else {
                updateStatus('api-support', 'âŒ ä¼ æ„Ÿå™¨APIä¸æ”¯æŒ', 'error');
                log('ä¼ æ„Ÿå™¨APIä¸æ”¯æŒï¼Œå¯èƒ½æ˜¯æµè§ˆå™¨é™åˆ¶');
            }
        }
        
        async function requestPermissionManual() {
            log('=== å¼€å§‹æ‰‹åŠ¨æƒé™è¯·æ±‚ ===');
            updateStatus('permission-status', 'è¯·æ±‚æƒé™ä¸­...', 'warning');
            
            try {
                // iOSæƒé™è¯·æ±‚
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    log('æ£€æµ‹åˆ°iOSè®¾å¤‡ï¼Œè¯·æ±‚DeviceOrientationEventæƒé™');
                    
                    const permission = await DeviceOrientationEvent.requestPermission();
                    log(`DeviceOrientationEventæƒé™ç»“æœ: ${permission}`);
                    
                    if (permission === 'granted') {
                        updateStatus('permission-status', 'âœ… iOSæƒé™å·²æˆäºˆ', 'success');
                        log('iOSæƒé™è¯·æ±‚æˆåŠŸ');
                    } else {
                        updateStatus('permission-status', `âŒ iOSæƒé™è¢«æ‹’ç»: ${permission}`, 'error');
                        log(`iOSæƒé™è¯·æ±‚å¤±è´¥: ${permission}`);
                    }
                } else {
                    // Android/å…¶ä»–è®¾å¤‡
                    log('æ£€æµ‹åˆ°Android/å…¶ä»–è®¾å¤‡ï¼Œå°è¯•ç›´æ¥å¯ç”¨ä¼ æ„Ÿå™¨');
                    updateStatus('permission-status', 'âœ… Androidè®¾å¤‡ï¼Œæ— éœ€æƒé™è¯·æ±‚', 'success');
                    log('Androidè®¾å¤‡ï¼Œæƒé™æ¨¡å¼ä¸åŒï¼Œç›´æ¥å°è¯•å¯ç”¨');
                }
                
                // æ— è®ºå¦‚ä½•éƒ½å°è¯•å¼€å§‹ç›‘å¬
                setTimeout(() => {
                    log('æƒé™è¯·æ±‚å®Œæˆï¼Œå‡†å¤‡å¼€å§‹ç›‘å¬');
                    startListening();
                }, 1000);
                
            } catch (error) {
                log(`æƒé™è¯·æ±‚å¼‚å¸¸: ${error.message}`);
                updateStatus('permission-status', `âŒ æƒé™è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function startListening() {
            if (isListening) {
                log('å·²ç»åœ¨ç›‘å¬ä¼ æ„Ÿå™¨ï¼Œè·³è¿‡é‡å¤å¯åŠ¨');
                return;
            }
            
            log('=== å¼€å§‹ç›‘å¬ä¼ æ„Ÿå™¨äº‹ä»¶ ===');
            isListening = true;
            
            // ç›‘å¬è®¾å¤‡æ–¹å‘
            window.addEventListener('deviceorientation', function(event) {
                const data = {
                    alpha: (event.alpha || 0).toFixed(1),
                    beta: (event.beta || 0).toFixed(1), 
                    gamma: (event.gamma || 0).toFixed(1)
                };
                
                document.getElementById('sensor-data').innerHTML = 
                    `Alpha: ${data.alpha}Â° | Beta: ${data.beta}Â° | Gamma: ${data.gamma}Â°`;
                
                // ç¬¬ä¸€æ¬¡æ”¶åˆ°æ•°æ®æ—¶è®°å½•
                if (!window.firstOrientationReceived) {
                    window.firstOrientationReceived = true;
                    log(`âœ… é¦–æ¬¡æ¥æ”¶åˆ°æ–¹å‘æ•°æ®: ${JSON.stringify(data)}`);
                    updateStatus('permission-status', 'âœ… ä¼ æ„Ÿå™¨å·¥ä½œæ­£å¸¸', 'success');
                }
            });
            
            // ç›‘å¬è®¾å¤‡è¿åŠ¨
            window.addEventListener('devicemotion', function(event) {
                if (event.acceleration && !window.firstMotionReceived) {
                    window.firstMotionReceived = true;
                    const accel = {
                        x: (event.acceleration.x || 0).toFixed(2),
                        y: (event.acceleration.y || 0).toFixed(2),
                        z: (event.acceleration.z || 0).toFixed(2)
                    };
                    log(`âœ… é¦–æ¬¡æ¥æ”¶åˆ°è¿åŠ¨æ•°æ®: ${JSON.stringify(accel)}`);
                }
            });
            
            log('ä¼ æ„Ÿå™¨äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
            
            // 5ç§’åæ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
            setTimeout(() => {
                if (!window.firstOrientationReceived && !window.firstMotionReceived) {
                    log('âš ï¸ 5ç§’å†…æœªæ”¶åˆ°ä¼ æ„Ÿå™¨æ•°æ®ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜');
                    updateStatus('permission-status', 'âš ï¸ æœªæ”¶åˆ°ä¼ æ„Ÿå™¨æ•°æ®', 'warning');
                    
                    // æä¾›è°ƒè¯•å»ºè®®
                    log('è°ƒè¯•å»ºè®®:');
                    log('1. å°è¯•è½»å¾®ç§»åŠ¨è®¾å¤‡');
                    log('2. æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®');
                    log('3. å°è¯•åˆ·æ–°é¡µé¢é‡æ–°è¯·æ±‚æƒé™');
                    log('4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯');
                }
            }, 5000);
        }
        
        function testConsoleOutput() {
            log('=== æ§åˆ¶å°è¾“å‡ºæµ‹è¯• ===');
            console.log('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯');
            console.log('DeviceOrientationEvent:', window.DeviceOrientationEvent);
            console.log('DeviceMotionEvent:', window.DeviceMotionEvent);
            console.log('requestPermissionæ–¹æ³•:', typeof DeviceOrientationEvent.requestPermission);
            console.log('å½“å‰åè®®:', location.protocol);
            console.log('å½“å‰åŸŸå:', location.hostname);
            
            log('æ§åˆ¶å°è¾“å‡ºå®Œæˆï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·');
            alert('è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼\n\nåœ¨Chromeä¸­ï¼šç‚¹å‡»èœå• -> æ›´å¤šå·¥å…· -> å¼€å‘è€…å·¥å…· -> Consoleæ ‡ç­¾');
        }
    </script>
</body>
</html> 