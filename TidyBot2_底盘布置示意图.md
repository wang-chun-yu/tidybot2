# TidyBot2 底盘脚轮布置示意图

## 1. 总体布置图（俯视图）

```
                    Y轴 (左侧方向)
                      ↑
                      |
     脚轮2 ●----------+----------● 脚轮1
        |             |             |
        |   h_y=0.170 |  h_y=-0.170 |
        |             |             |
        |             |             |
        |             |             |
   -----+-------------+-------------+----→ X轴 (前进方向)
        |             |             |
        |             |             |
        |   h_x=-0.190|  h_x=0.190  |
        |             |             |
        |             |             |
     脚轮3 ●----------+----------● 脚轮4
                      |
                  底盘中心 (0,0)
```

## 2. 脚轮详细参数

### 脚轮位置坐标 (相对于底盘中心)
| 脚轮编号 | X坐标 (m) | Y坐标 (m) | 转向电机ID | 驱动电机ID |
|----------|-----------|-----------|------------|------------|
| 脚轮1    | +0.190    | -0.170    | 1          | 2          |
| 脚轮2    | +0.190    | +0.170    | 3          | 4          |
| 脚轮3    | -0.190    | +0.170    | 5          | 6          |
| 脚轮4    | -0.190    | -0.170    | 7          | 8          |

### 脚轮物理参数
- **底盘尺寸**：380.3mm × 340.3mm (长×宽)
- **脚轮偏移**：
  - b_x = -14.008mm (转向轴到接触点前后偏移)
  - b_y = -3.753mm (转向轴到接触点左右偏移)
- **轮子半径**：r = 50.8mm
- **电机类型**：TalonFX (Phoenix 6)
- **编码器**：CANcoder绝对编码器

## 3. 单个脚轮结构图

```
     转向轴中心 ●
                |
                | 偏移距离
                | (b_x, b_y)
                ↓
            ┌─────────┐
            │  驱动轮  │ ← 接触点
            │ (r=50.8) │
            └─────────┘
                ↑
            轮子朝向 (可旋转)
```

## 4. 传动系统

### 齿轮比参数
| 参数 | 符号 | 数值 | 说明 |
|------|------|------|------|
| 转向齿轮比 | N_s | 12.8 | 转向电机到转向轴 |
| 驱动齿轮比1 | N_r1 | 3.571 | 驱动第一级减速 |
| 驱动齿轮比2 | N_r2 | 0.76 | 驱动第二级减速 |
| 轮子齿轮比 | N_w | 3.0 | 轮子传动减速 |

### 运动学耦合关系
由于机械结构设计，转向和驱动存在耦合：
- 转向运动会影响驱动轮的转动
- 控制算法需要补偿这种耦合效应

```
转向电机速度 = N_s × 转向关节速度
驱动电机速度 = N_r1 × 转向关节速度 - N_r1_r2_w × 驱动关节速度
```

## 5. 控制系统架构

### 控制层次
```
高层命令 (速度/位置)
        ↓
在线轨迹生成 (Ruckig OTG)
        ↓
运动学逆解算 (C矩阵)
        ↓
关节速度分配
        ↓
电机FOC控制 (TalonFX)
        ↓
硬件执行
```

### 坐标系定义
- **全局坐标系**：固定在地面，X轴指向前进方向，Y轴指向左侧
- **本体坐标系**：固定在底盘中心，随底盘运动
- **脚轮坐标系**：每个脚轮的局部坐标系

## 6. 运动学特性

### 自由度
- **底盘自由度**：3DOF (X, Y, θ)
- **关节自由度**：8DOF (4个转向 + 4个驱动)
- **冗余度**：5 (8-3=5个冗余自由度)

### 运动能力
- **全方向移动**：可沿任意方向平移
- **原地旋转**：可在原地进行旋转运动
- **复合运动**：可同时进行平移和旋转

### 运动约束
- 每个脚轮必须满足无滑移约束
- 转向轮只能沿其朝向方向滚动
- 驱动轮垂直于转向轮方向滚动

## 7. 安全特性

### 电流限制
- **转向电机**：40A (防止过载和确保安全)
- **驱动电机**：10A (硬地面条件下)

### 保护机制
- 单实例运行保护 (PID文件锁)
- 命令超时保护 (2.5倍策略周期)
- 脚轮翻转减速保护 (>720°/s时减速)
- 电压监控 (最低11.5V)

---

**注释**：
- 本图展示了TidyBot2底盘的4WIS/4WID (四轮独立转向驱动) 配置
- 实际生成的PNG图片提供了更详细的可视化信息
- 坐标原点位于底盘几何中心
- 所有尺寸基于实际物理参数 